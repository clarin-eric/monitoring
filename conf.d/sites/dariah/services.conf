// http Service Check
apply Service "http Service" {
    import "generic-service"
    check_command = "http"
    assign where host.vars.check_http == true
}

apply Service "check_diskspace" {
	import "generic-service"
	check_command = "nrpe-check-1arg"
	vars.check = "check_diskspace"
	assign where host.vars.standard_checks==true
}

apply Service "check_load" {
	import "generic-service"
	check_command = "nrpe-check-1arg"
	vars.check = "check_load"
	assign where host.vars.standard_checks==true
}

apply Service "check_mem" {
	import "generic-service"
	check_command = "nrpe-check-1arg"
	vars.check = "check_mem"
	assign where host.vars.standard_checks==true
}

apply Service "check_ntp_time" {
	import "generic-service"
	check_command = "nrpe-check-1arg"
	vars.check = "check_ntp_time"
	assign where host.vars.standard_checks==true
}

#apply Service "check_puppet_agent" {
#	import "generic-service"
#	check_command = "nrpe-check-1arg"
#	vars.check = "check_puppet_agent"
#	assign where host.vars.standard_checks==true
#}

apply Service "check_swap" {
	import "generic-service"
	check_command = "nrpe-check-1arg"
	vars.check = "check_swap"
	assign where host.vars.standard_checks==true
}

apply Service "check_total_procs" {
	import "generic-service"
	check_command = "nrpe-check-1arg"
	vars.check = "check_total_procs"
	assign where host.vars.standard_checks==true
}

# try to fine tune apt update/upgrade service probes: shall only be tested once each day and AFTER the automatic server updates at 2 am...
apply Service "APT updates" {
	import "generic-service"
	check_command = "nrpe-check-1arg"
	vars.check = "check_updates"
	assign where host.vars.standard_checks==true
    # Check only between 2:30 and 3:30
    check_period = "update_time"
    # Updates are probed every hour
    check_interval = 60
    # Re-notify about service problems every day only
    host.vars.notification_interval = 1440
    # No notifications on WARNING states!
    # u=UNKNOWN, c=CRITICAL, r=OK, f=FLAPPING, w=WARNING, s=SCHEDULED
    host.vars.notification_options = "u, c, r, f, s"
}

apply Service "check_zombie_procs" {
	import "generic-service"
	check_command = "nrpe-check-1arg"
	vars.check = "check_zombie_procs"
	assign where host.vars.standard_checks==true
}

apply Service "Check outdated binaries" {
    import "generic-service"
    check_command = "nrpe-check-1arg"
    vars.check = "check_reboot-required"
    assign where "SUB-FE-PROD" in host.groups
    # Check only between 4:30 and 5:30
    check_period = "need_restart_time"
    # Updates are probed every hour
    check_interval = 60
    # Re-notify about service problems every day only
    host.vars.notification_interval = 1440
}
